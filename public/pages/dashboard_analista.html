<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Monitoramento</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
        integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="../css/dash_analista.css">
    <link rel="stylesheet" href="../css/menuLateralAlternativo.css" />
    <link rel="stylesheet" href="../css/modalPerfil.css">
    <script src="../js/criacaoMenuLateral.js"></script>
    <script src="../js/modais.js"></script>
<body onload="renderizarModalUsuario();carregarMenuLateral()">
    <div id="sistema_modais">
    </div>
    <main class="container-main" id="main_page">
        <div id="barralateral" class="barra-lateral">
            <!-- Menu lateral será carregado via JavaScript -->
        </div>
        
        <div class="mainContent">
            
            <div class="central">
                <div class="centralMain">
                    <div class="mainHeader">
                        <div class="selectServer">
                            Servidores:
                            <input type="checkbox" id="chkServer" oninput="toggleServerList()">
                            <label for="chkServer" class="boxSelect">
                                <span id="nomeServer">Selecione um servidor</span>
                                <svg width="22" height="13" viewBox="0 0 22 13" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M9.78825 12.5399L0.3417 3.09327C-0.1139 2.63767 -0.1139 1.89903 0.3417 1.44348L1.44349 0.341688C1.89831 -0.113133 2.63545 -0.114009 3.09134 0.339744L10.6132 7.82634L18.135 0.339744C18.5909 -0.114009 19.328 -0.113133 19.7828 0.341688L20.8846 1.44348C21.3402 1.89908 21.3402 2.63772 20.8846 3.09327L11.4381 12.5399C10.9825 12.9954 10.2439 12.9954 9.78825 12.5399Z"
                                        fill="#F0F0F0" />
                                </svg>
                            </label>

                            <div class="containerOptionsServer" id="optionsServer">
                                <div class="wrapper" id="spawnpointServer">
                                    <!-- Opções de servidores serão carregadas via JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="donutHolder">
                        <div class="containerDonut" onclick="expandirDash('RAM')">
                            <div class="donutTitle">
                                <i class="fas fa-memory"></i>
                                Uso de RAM
                            </div>
                            <div class="midDonut">
                                <div id="ramStatus" class="statusComp"></div>
                                <div class="donut">
                                    <canvas id="graficoRAM"></canvas>
                                </div>
                            </div>
                        </div>

                        <div class="containerDonut" onclick="expandirDash('Disco')">
                            <div class="donutTitle">
                                <i class="fas fa-hdd"></i>
                                Uso de Disco
                            </div>
                            <div class="midDonut">
                                <div id="discoStatus" class="statusComp"></div>
                                <div class="donut">
                                    <canvas id="graficoDisco"></canvas>
                                </div>
                            </div>
                        </div>

                        <div class="containerDonut" onclick="expandirDash('CPU')">
                            <div class="donutTitle">
                                <i class="fas fa-microchip"></i>
                                Uso de CPU
                            </div>
                            <div class="midDonut">
                                <div id="cpuStatus" class="statusComp"></div>
                                <div class="donut">
                                    <canvas id="graficoCPU"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bigDashHolder">
                        <canvas id="graficoPrincipal"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <script>
        // Dados dos servidores
        const servidores = [
            {
                "servidor": "Servidor 1",
                "RAM": 75,
                "Disco": 60,
                "CPU": 85
            },
            {
                "servidor": "Servidor 2",
                "RAM": 40,
                "Disco": 90,
                "CPU": 55
            },
            {
                "servidor": "Servidor 3",
                "RAM": 65,
                "Disco": 70,
                "CPU": 80
            },
            {
                "servidor": "Servidor 4",
                "RAM": 30,
                "Disco": 50,
                "CPU": 95
            },
            {
                "servidor": "Servidor 5",
                "RAM": 85,
                "Disco": 40,
                "CPU": 60
            },
            {
                "servidor": "Servidor 6",
                "RAM": 55,
                "Disco": 75,
                "CPU": 45
            },
            {
                "servidor": "Servidor 7",
                "RAM": 20,
                "Disco": 65,
                "CPU": 70
            },
            {
                "servidor": "Servidor 8",
                "RAM": 90,
                "Disco": 30,
                "CPU": 50
            },
            {
                "servidor": "Servidor 9",
                "RAM": 10,
                "Disco": 80,
                "CPU": 95
            },
            {
                "servidor": "Servidor 10",
                "RAM": 50,
                "Disco": 55,
                "CPU": 40
            }
        ];

        // Armazenar instâncias dos gráficos
        const charts = {
            RAM: null,
            Disco: null,
            CPU: null,
            Principal: null
        };

        // Servidor selecionado atualmente
        let servidorAtual = null;
        
        // Dados de histórico para o gráfico principal (simulados)
        const historicoSimulado = {
            CPU: [65, 70, 75, 80, 85, 82, 78, 80, 85, 88, 85, 83],
            RAM: [60, 65, 68, 70, 72, 75, 73, 74, 75, 77, 76, 75],
            Disco: [50, 52, 55, 57, 59, 60, 58, 59, 60, 62, 61, 60]
        };
        
        // Timestamps para o eixo X (últimas 12 horas)
        const timestamps = [...Array(12).keys()].map(i => {
            const now = new Date();
            now.setHours(now.getHours() - (11 - i));
            return now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        });

        // Inicializar a página
        document.addEventListener('DOMContentLoaded', () => {
            carregarListaServidores();
            selecionarServidor(0);
        });

        // Carregar lista de servidores no dropdown
        function carregarListaServidores() {
            const spawnpoint = document.getElementById('spawnpointServer');
            spawnpoint.innerHTML = servidores.map((servidor, index) => 
                `<span onclick="toggleServerList(); selecionarServidor(${index});">${servidor.servidor}</span>`
            ).join('');
        }

        // Mostrar/esconder lista de servidores
        function toggleServerList() {
            const lista = document.getElementById('optionsServer');
            if (lista.style.display === 'block') {
                lista.style.display = 'none';
            } else {
                lista.style.display = 'block';
            }
        }

        // Selecionar um servidor e atualizar os gráficos
        function selecionarServidor(index) {
            servidorAtual = servidores[index];
            document.getElementById('nomeServer').textContent = servidorAtual.servidor;
            
            atualizarStatus('RAM', servidorAtual.RAM);
            atualizarStatus('Disco', servidorAtual.Disco);
            atualizarStatus('CPU', servidorAtual.CPU);
            
            atualizarGrafico('RAM', servidorAtual.RAM);
            atualizarGrafico('Disco', servidorAtual.Disco);
            atualizarGrafico('CPU', servidorAtual.CPU);
            
            atualizarGraficoPrincipal();
        }

        // Atualizar o status visual (texto e ícone)
        function atualizarStatus(componente, valor) {
            const elementoStatus = document.getElementById(`${componente.toLowerCase()}Status`);
            
            if (valor > 80) {
                elementoStatus.innerHTML = `
                    <b style="color: #e74c3c;">Crítico!</b>
                    <i class="fas fa-fire" style="color: #e74c3c;"></i>
                `;
            } else if (valor > 60) {
                elementoStatus.innerHTML = `
                    <b style="color: #f39c12;">Alerta!</b>
                    <i class="fas fa-exclamation-triangle" style="color: #f39c12;"></i>
                `;
            } else {
                elementoStatus.innerHTML = `
                    <b style="color: #2ecc71;">Estável</b>
                    <i class="fas fa-check-circle" style="color: #2ecc71;"></i>
                `;
            }
        }

        // Atualizar cada gráfico individual (donut)
        function atualizarGrafico(componente, valor) {
            const canvas = document.getElementById(`grafico${componente}`);
            const ctx = canvas.getContext('2d');
            
            // Determinar cor baseada no valor
            let cor;
            if (valor > 80) {
                cor = '#e74c3c'; // Vermelho - crítico
            } else if (valor > 60) {
                cor = '#f39c12'; // Amarelo - alerta
            } else {
                cor = '#2ecc71'; // Verde - estável
            }
            
            // Destruir gráfico anterior se existir
            if (charts[componente]) {
                charts[componente].destroy();
            }
            
            // Criar novo gráfico
            charts[componente] = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Usado', 'Disponível'],
                    datasets: [{
                        data: [valor, 100 - valor],
                        backgroundColor: [cor, '#24283e'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    cutout: '60%',
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.raw}%`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Atualizar o gráfico principal (histórico)
        function atualizarGraficoPrincipal() {
            const canvas = document.getElementById('graficoPrincipal');
            const ctx = canvas.getContext('2d');
            
            // Destruir gráfico anterior se existir
            if (charts.Principal) {
                charts.Principal.destroy();
            }
            
            // Simular histórico com uma pequena variação baseada no valor atual
            const componenteAtual = servidorAtual.RAM > 70 ? 'RAM' : (servidorAtual.CPU > 70 ? 'CPU' : 'Disco');
            
            // Criar gráfico de linha
            charts.Principal = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: timestamps,
                    datasets: [
                        {
                            label: 'CPU',
                            data: historicoSimulado.CPU,
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: true
                        },
                        {
                            label: 'RAM',
                            data: historicoSimulado.RAM,
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: true
                        },
                        {
                            label: 'Disco',
                            data: historicoSimulado.Disco,
                            borderColor: '#2ecc71',
                            backgroundColor: 'rgba(46, 204, 113, 0.1)',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                color: '#f0f0f0'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#f0f0f0'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#f0f0f0',
                                boxWidth: 12
                            }
                        },
                        title: {
                            display: true,
                            text: `Histórico de Utilização - ${servidorAtual.servidor}`,
                            color: '#f0f0f0',
                            font: {
                                size: 16
                            }
                        }
                    }
                }
            });
        }
        
        // Expandir dashboard para mostrar mais detalhes de um componente específico
        function expandirDash(componente) {
            // Atualizar gráfico principal para mostrar apenas o componente selecionado
            if (charts.Principal) {
                charts.Principal.destroy();
            }
            
            const canvas = document.getElementById('graficoPrincipal');
            const ctx = canvas.getContext('2d');
            
            // Simular histórico mais detalhado para o componente específico
            // Gerar dados mais detalhados para as últimas 24 horas
            const horasDetalhadas = [...Array(24).keys()].map(i => {
                const now = new Date();
                now.setHours(now.getHours() - (23 - i));
                return now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            });
            
            // Gerar dados simulados mais detalhados
            const valorBase = servidorAtual[componente];
            const dadosDetalhados = horasDetalhadas.map((_, i) => {
                // Simular uma variação de +/- 10% do valor atual
                return Math.max(0, Math.min(100, valorBase + (Math.random() * 20 - 10)));
            });
            
            // Definir cor baseada no componente
            let corComponente;
            switch(componente) {
                case 'CPU': corComponente = '#e74c3c'; break;
                case 'RAM': corComponente = '#3498db'; break;
                case 'Disco': corComponente = '#2ecc71'; break;
            }
            
            // Criar gráfico detalhado
            charts.Principal = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: horasDetalhadas,
                    datasets: [
                        {
                            label: `${componente}`,
                            data: dadosDetalhados,
                            borderColor: corComponente,
                            backgroundColor: `${corComponente}33`,
                            borderWidth: 2,
                            tension: 0.3,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                color: '#f0f0f0',
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#f0f0f0'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#f0f0f0',
                                boxWidth: 12
                            }
                        },
                        title: {
                            display: true,
                            text: `Utilização Detalhada de ${componente} - ${servidorAtual.servidor}`,
                            color: '#f0f0f0',
                            font: {
                                size: 16
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>

</html>