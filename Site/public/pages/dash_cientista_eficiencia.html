<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Efeciência</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <link rel="stylesheet" href="../css/dash_cientista_eficiencia_claro.css">
  <link rel="stylesheet" href="../css/barra_lateral.css">
  <script src="../js/barra_lateral.js" defer></script>
</head>

<body onload="carregarMenuLateral(); carregarServidores(); kpi1_geral(); kpi2_geral()">
  <div class="navbar">
    <i onclick="mudarIcone()" id="menu-bar">&#9776;</i>
    <div class="container_perfil_menu" id="modal_perfil">
      <i class="fa-solid fa-bell" onclick="abrirModal('notificacoes')"></i>
      <span class="barraVertical"></span>
      <div class="button_perfil_nav_bar" onclick="abrirModal('perfil')">
        <img class="imgPerfil" id="rogerioCientista2" style="display: none; border-radius: 50%;"
          src="../assets/icons_protopersonas/rogerioCientista.png" alt="" height="80" />
        <img class="imgPerfil" id="jenniferADM2" style="display: none; border-radius: 50%;"
          src="../assets/icons_protopersonas/jenniferADM.png" alt="" height="80" />
        <img class="imgPerfil" id="juliaAnalista2" style="display: none; border-radius: 50%;"
          src="../assets/icons_protopersonas/juliaAnalista.png" alt="" height="80" />
        <i class="fa-solid fa-chevron-down"></i>
      </div>
    </div>
  </div>
  <div id="barralateral" class="barra-lateral"></div>
  <main>

     <!-- Modal de servidor -->

     <div id="backdrop" class="backdrop"></div>

    <div class="modal" id="modalServidor" style="display: none;">
      <div class="linha1Modal">
        <span class="titulo" id="servidorModal" style="color: #2b2b2b;"></span>
        <i onclick="fecharModal()" class="fa-solid fa-xmark"></i>
      </div>
      <div class="servidorETempo">
        <span id="infoServidorModal"></span>
        <div class="periodo" style="display: flex; flex-direction: row; justify-content: space-between; width: 30%;">
          <button onclick="ativarBotao(this)" id="7dias" class="botaoTempo"> 7 dias </button>
          <button onclick="ativarBotao(this)" id="30dias" class="botaoTempo"> 30 dias </button>
          <button onclick="ativarBotao(this)" id="6meses" class="botaoTempo"> 6 meses </button>
        </div>
      </div>
      <div class="contentModal">
        <div class="kpisModal">
          <div class="kpi" style="width: 15vw;">
            <span class="textKpi">Tempo em alerta:</span>
            <span id="tempoAlerta" class="metricaKpi"> 2d 4h</span>
            <div id="indicadorKpi1Modal" class="indicador">Ideal</div>
          </div>
          <div class="kpi" style="width: 15vw;">
            <span class="textKpi">Tempo ocioso:</span>
            <span id="tempoOcioso" class="metricaKpi"></span>
            <div id="indicadorKpi2Modal" class="indicador"></div>
          </div>
          <div class="kpi" style="width: 15vw;">
            <span class="textKpi">Tempo estável:</span>
            <span id="tempoEstavel" class="metricaKpi"></span>
            <div id="indicadorKpi3Modal" class="indicador"></div>
          </div>
        </div>
        <div class="graficosModal">
          <div class="grafico4">
            <span class="tituloModal">Percentual de ociosidade ao longo do tempo</span>
            <div id="chart4"></div>
          </div>
          <div class="grafico5">
            <span class="tituloModal">Desempenho dos componentes em horas</span>
            <div id="chart5"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="main">
      <div class="kpis">
        <div class="periodo">
          <button onclick="ativarBotao(this, '7dias'); kpi1_geral(); kpi2_geral()" id="7dias" class="botaoTempo"> 7 dias </button>
          <button onclick="ativarBotao(this, '30dias'); kpi1_geral(); kpi2_geral()" id="30dias" class="botaoTempo"> 30 dias </button>
          <button onclick="ativarBotao(this, '6meses'); kpi1_geral(); kpi2_geral()" id="6meses" class="botaoTempo"> 6 meses </button>
        </div>
        <div class="kpi">
          <span class="textKpi">Média de ociosidade por servidor</span>
          <span id="mediaOciosidade" class="metricaKpi"></span>
          <div id="indicadorKpi1"></div>
        </div>
        <div class="kpi">
          <span class="textKpi">Componente mais ocioso</span>
          <span id="componenteOciosidade" class="metricaKpi"></span>
          <div id="indicadorKpi2" class="indicador"></div>
        </div>
        <div class="kpi">
          <span class="textKpi">Servidores com 50% ou mais de ociosidade</span>
          <span id="50ouMaisOciosidade" class="metricaKpi">12</span>
          <div id="indicadorKpi3" class="indicador"></div>
        </div>
      </div>
      <div class="content1">
        <div class="tabela">
          <span class="titulo">5 servidores mais ociosos</span>
          <table id="tabelaOcioso" class="tabelaDados">
            <thead>
              <!-- <tr>
                <th>Servidor</th>
                <th>Tempo de ociosidade</th>
              </tr> -->
            </thead>
            <tbody id="bodyTabela"></tbody>
          </table>
        </div>
        <div class="grafico3">
          <span class="titulo">Desempenho dos componentes em horas </span>
          <div id="chart3"></div>
        </div>

      </div>
      <div class="content2">
        <div class="grafico2">
          <span class="titulo">Distribuição do tempo de desempenho do datacenter</span>
          <div id="chart2"></div>
        </div>
        <div class="grafico1">
          <span class="titulo">Percentual de ociosidade ao longo do tempo</span>
          <div id="chart"></div>
        </div>
      </div>
    </div>

   
  </main>
</body>

</html>



<script>


  function ativarBotao(botaoClicado, tempo) {
  const botoes = document.querySelectorAll('.periodo button');
  botoes.forEach(botao => botao.classList.remove('ativo')); 
  botaoClicado.classList.add('ativo'); 
  sessionStorage.setItem("botaoTempo", tempo); 
}



  // tabela de servidores
  var servidores = [
    {
      servidor: "4",
      tempo: "25d 6h",
      percentualAcima: 48
    },

    {
      servidor: "6",
      tempo: "22d 6h",
      percentualAcima: 41
    },

    {
      servidor: "7",
      tempo: "18d 6h",
      percentualAcima: 35
    },

    {
      servidor: "1",
      tempo: "14d 6h",
      percentualAcima: 32
    },

    {
      servidor: "9",
      tempo: "7d 3h",
      percentualAcima: 16
    },

  ];

// mediaOciosidade
// componenteOciosidade
// 50ouMaisOciosidade

mediaOciosidadeServidor = [32, 151, 257]


mediaOciosidadeComponente = [
  {cpu: 28,
   ram: 18, 
   disco: 25
   },
  {cpu: 38,
   ram: 12, 
   disco: 29
   },
  {cpu: 25,
   ram: 8, 
   disco: 32
   },
  ]

ociosidade50 = [27, 18, 12]

  function kpi1_geral(){
    tempo = sessionStorage.botaoTempo
    let indicador1 = document.getElementById("indicadorKpi1");
    let indicador3 = document.getElementById("indicadorKpi3");

    minKpi1 = 7 * 24 * 0.1
    maxKpi1 = 7 * 24 * 0.12
    minKpi2 = 30 * 24 * 0.1
    maxKpi2 = 30 * 24 * 0.15
    minKpi3 = 180 * 24 * 0.1
    maxKpi3 = 180 * 24 * 0.15


    if(tempo == '7dias'){
      kpi1 = mediaOciosidadeServidor[0]

      if(kpi1 < minKpi1){
          mediaOciosidade.innerHTML = `${kpi1}h`;
          indicador1.classList.add("indicador-ruim")
          indicadorKpi1.innerHTML = `${(minKpi1 - kpi1).toFixed(1)}h abaixo do ideal <i class="fa-solid fa-arrow-trend-down"></i>`
      } else if (kpi1 > maxKpi1) {
          mediaOciosidade.innerHTML = `${kpi1}h`;
          indicador1.classList.add("indicador-ruim")
          indicadorKpi1.innerHTML = `${(kpi1 - maxKpi1).toFixed(1)}h acima do ideal <i class="fa-solid fa-arrow-trend-up"></i>`
      } else {
          mediaOciosidade.innerHTML = `${kpi1}h`;
          indicador1.classList.add("indicador-ideal")
          indicadorKpi1.innerHTML = `Ideal`
      }
    } else if (tempo == '30dias'){

        kpi1 = mediaOciosidadeServidor[1]
      
        if(kpi1 < minKpi2){
           mediaOciosidade.innerHTML = `${kpi1}h`;
          indicador1.classList.add("indicador-ruim")
          indicadorKpi1.innerHTML = `${(minKpi2 - kpi1).toFixed(1)}h abaixo do ideal <i class="fa-solid fa-arrow-trend-down"></i>`
        } else if (kpi1 > maxKpi2) {
          mediaOciosidade.innerHTML = `${kpi1}h`;
          indicador1.classList.add("indicador-ruim")
          indicadorKpi1.innerHTML = `${(kpi1 - maxKpi2).toFixed(1)}h acima do ideal <i class="fa-solid fa-arrow-trend-up"></i>`
      } else {
          mediaOciosidade.innerHTML = `${kpi1}h`;
          indicador1.classList.add("indicador-ideal")
          indicadorKpi1.innerHTML = `Ideal`
      }
    }

    else { 

        kpi1 = mediaOciosidadeServidor[2]
      
        if(kpi1 < minKpi3){
           mediaOciosidade.innerHTML = `${kpi1}h`;
          indicador1.classList.add("indicador-ruim")
          indicadorKpi1.innerHTML = `${(minKpi3 - kpi1).toFixed(1)}h abaixo do ideal <i class="fa-solid fa-arrow-trend-down"></i>`
        } else if (kpi1 > maxKpi3) {
          mediaOciosidade.innerHTML = `${kpi1}h`;
          indicador1.classList.add("indicador-ruim")
          indicadorKpi1.innerHTML = `${(kpi1 - maxKpi3).toFixed(1)}h acima do ideal <i class="fa-solid fa-arrow-trend-up"></i>`
      } else {
          mediaOciosidade.innerHTML = `${kpi1}h`;
          indicador1.classList.add("indicador-ideal")
          indicadorKpi1.innerHTML = `Ideal`
      }
    }



}

  function kpi2_geral(){
     tempo = sessionStorage.botaoTempo

     var componentes = []
     var media = []
     var percentual = []

    let indicador2 = document.getElementById("indicadorKpi2");

    for (let i = 0; i < mediaOciosidadeComponente.length; i++) {
    const dados = mediaOciosidadeComponente[i];

  const cpu = dados.cpu;
  const ram = dados.ram;
  const disco = dados.disco;

  let maiorComponente = 'CPU';
  let maiorValor = cpu;

  if (ram > maiorValor) {
    maiorComponente = 'RAM';
    maiorValor = ram;
  }
  if (disco > maiorValor) {
    maiorComponente = 'DISCO';
    maiorValor = disco;
  }

  let somaOutros = 0;
  if (maiorComponente === 'CPU') {
    somaOutros = ram + disco;
  } else if (maiorComponente === 'RAM') {
    somaOutros = cpu + disco;
  } else {
    somaOutros = cpu + ram;
  }

  const mediaOutros = somaOutros / 2;

  const percentualAcima = ((maiorValor - mediaOutros) / mediaOutros) * 100;
      
    

   componentes.push(maiorComponente)
   media.push(mediaOutros)
   percentual.push(percentualAcima)

}

   if(tempo == '7dias'){
    componenteOciosidade.innerHTML = componentes[0]
    indicador2.classList.add('indicador-ruim')
    indicadorKpi2.innerHTML = `${percentual[0].toFixed(1)}% a mais que outros componentes <i class="fa-solid fa-arrow-trend-up"></i>`
   } else if (tempo == '30dias'){
    componenteOciosidade.innerHTML = componentes[1]
    indicador2.classList.add('indicador-ruim')
    indicadorKpi2.innerHTML = `${percentual[1].toFixed(1)}% a mais que outros componentes <i class="fa-solid fa-arrow-trend-up"></i>`
   } else {
    componenteOciosidade.innerHTML = componentes[2]
    indicador2.classList.add('indicador-ruim')
    indicadorKpi2.innerHTML = `${percentual[1].toFixed(2)}% a mais que outros componentes <i class="fa-solid fa-arrow-trend-up"></i>`
   }

  }



  //grafico 1
  var ociosidadeTempoCPU = [100, 52, 38, 45, 19, 23, 2]
  var ociosidadeTempoDisco = [10, 52, 38, 4, 9, 3, 20]
  var ociosidadeTempoRAM = [1, 2, 38, 45, 91, 28, 20]
  var ociosidadeTempo = ["01 Jan", "02 Jan", "03 Jan", "04 Jan", "05 Jan", "06 Jan", "07 Jan"]

  // grafico 2
  var ociosidadePercentual = [60, 27, 13]

  // grafico 3
  var estavelComponentes = [44, 55, 57]
  var ociosoComponentes = [76, 85, 101]
  var alertaComponentes = [35, 41, 36]

  


  var infoServidorModalT = "Procesador: i5 - RAM total: 32GB  - Disco Total: 500GB"
  infoServidorModal.innerHTML += infoServidorModalT




  function carregarServidores() {
    for (var i = 0; i < servidores.length; i++) {
      let status = servidores[i].percentualAcima;



      bodyTabela.innerHTML += `
            <tr>
            <td> Servidor ${servidores[i].servidor}</td>
            <td>${servidores[i].tempo}</td>
            
            <td> <i onclick="abrirModalServidor('${servidores[i].servidor}')" class="fa-solid fa-circle-info"></i></td>
             `;
    }

  }
  function abrirModalServidor(servidor) {
  servidorModal.innerHTML = `Servidor ${servidor}`
  const modalServidor = document.getElementById('modalServidor'); // ou outro seletor
  modalServidor.style.display = "flex";
   document.getElementById('backdrop').style.display = 'block';

}

function fecharModal() {
  document.getElementById('modalServidor').style.display = 'none';
  document.getElementById('backdrop').style.display = 'none';
}

document.getElementById('backdrop').addEventListener('click', fecharModal);


  var options = {
    chart: {
      type: "line",
      width: '100%',   // 100% do div grafico1
      height: '100%',
      foreColor: '#2b2b2b',  // cor do texto clara
      toolbar: {
        show: true,
        tools: {
          download: true,
          selection: false,
          zoom: false,
          zoomin: false,
          zoomout: false,
          pan: false,
          reset: false
        }
      }
    },
    // colors: ['#FFB133', '#FFFFFF', '#FF0000'], // cor da linha (e do preenchimento também)
    dataLabels: {
      enabled: false
    },
    series: [
      {
        name: "CPU",
        data: ociosidadeTempoCPU
      },
      {
        name: "Disco",
        data: ociosidadeTempoDisco
      },
      {
        name: "RAM",
        data: ociosidadeTempoRAM
      }
    ],
    fill: {
      type: "solid",

    },
    xaxis: {
      categories: ociosidadeTempo,
      labels: {
        style: {
          colors: '#2b2b2b' // texto dos rótulos do eixo x
        }
      }
    },
    yaxis: {
      labels: {
        style: {
          colors: '#2b2b2b' // texto dos rótulos do eixo y
        }
      }
    },
    grid: {
      borderColor: '#cccccc ' // cor discreta para a grade
    },
    tooltip: {
      enabled: true,
      theme: 'dark' // tooltip escura
    }
  };

  var chart = new ApexCharts(document.querySelector("#chart"), options);
  chart.render();

  var options2 = {
    series: ociosidadePercentual,
    labels: ['Estável', 'Ocisoso', 'Alerta'],
    chart: {
      width: '100%',
      height: '85%',
      type: 'pie',
      background: 'transparent',
      foreColor: '#000000', // cor do texto

    },
    colors: ['#00B276', '#FFB133', '#FF4A4D'], // cores personalizadas dos pedaços
    tooltip: {
      theme: 'dark' // tooltip escura
    },
    dataLabels: {
      enabled: true,
      style: {
        colors: ['#242d4a'],// muda a cor da % sobre as fatias
        fontSize: '12px'
      },
      dropShadow: {
        enabled: false  // REMOVE a sombra
      }
    },
    legend: {
      labels: {
        colors: '#2b2b2b' // cor da legenda
      }
    },
    stroke: {
      show: false
    },
    responsive: [{
      breakpoint: 480,
      options: {
        chart: {
          width: 200
        },
        legend: {
          position: 'bottom'
        }
      }
    }]
  };


  var chart2 = new ApexCharts(document.querySelector("#chart2"), options2);
  chart2.render();




  var options3 = {
    series: [{
      name: 'Estável',
      data: estavelComponentes
    }, {
      name: 'Ocioso',
      data: ociosoComponentes
    }, {
      name: 'Alerta',
      data: alertaComponentes
    }],
    colors: ['#00B276', '#FFB133', '#FF4A4D'],
    chart: {
      type: 'bar',
      height: 350,
      foreColor: '#2b2b2b',
      width: '100%',
      height: '100%'
    },
    plotOptions: {
      bar: {
        horizontal: false,
        columnWidth: '55%',
        borderRadius: 0,
        borderRadiusApplication: 'end'
      },
    },

    stroke: {
      show: true,
      width: 2,
      colors: ['transparent']
    },
    xaxis: {
      categories: ['CPU', 'RAM', 'DISCO'],
    },
    yaxis: {
      title: {
        text: 'Horas'
      }
    },
    fill: {
      opacity: 1
    },
    tooltip: {
      theme: 'dark'
    }
  };

  var chart3 = new ApexCharts(document.querySelector("#chart3"), options3);
  chart3.render();




  // Graficos modal

  var options4 = {
    chart: {
      type: "line",
      width: '100%',   // 100% do div grafico1
      height: '100%',
      foreColor: '#ffffff',  // cor do texto clara
      toolbar: {
        show: true,
        tools: {
          download: true,
          selection: false,
          zoom: false,
          zoomin: false,
          zoomout: false,
          pan: false,
          reset: false
        }
      }
    },
    colors: ['#FFB133'], // cor da linha (e do preenchimento também)
    dataLabels: {
      enabled: false
    },
    series: [
      {
        name: "Series 1",
        data: ociosidadeTempoValores
      }
    ],
    fill: {
      type: "solid",

    },
    xaxis: {
      categories: ociosidadeTempo,
      labels: {
        style: {
          colors: '#ffffff' // texto dos rótulos do eixo x
        }
      }
    },
    yaxis: {
      labels: {
        style: {
          colors: '#ffffff' // texto dos rótulos do eixo y
        }
      }
    },
    grid: {
      borderColor: '#cccccc' // cor discreta para a grade
    },
    tooltip: {
      enabled: true,
      theme: 'dark' // tooltip escura
    }
  };

  var chart4 = new ApexCharts(document.querySelector("#chart4"), options4);
  chart4.render();


  var options5 = {
    series: [{
      name: 'Estável',
      data: estavelComponentes
    }, {
      name: 'Ocioso',
      data: ociosoComponentes
    }, {
      name: 'Alerta',
      data: alertaComponentes
    }],
    colors: ['#00B276', '#FFB133', '#FF4A4D'],
    chart: {
      type: 'bar',
      height: 350,
      foreColor: '#fff',
      width: '100%',
      height: '100%'
    },
    plotOptions: {
      bar: {
        horizontal: false,
        columnWidth: '55%',
        borderRadius: 0,
        borderRadiusApplication: 'end'
      },
    },

    stroke: {
      show: true,
      width: 2,
      colors: ['transparent']
    },
    xaxis: {
      categories: ['CPU', 'RAM', 'DISCO'],
    },
    yaxis: {
      title: {
        text: 'Horas'
      }
    },
    fill: {
      opacity: 1
    },
    tooltip: {
      theme: 'dark'
    }
  };

  var chart5 = new ApexCharts(document.querySelector("#chart5"), options5);
  chart5.render();




</script>